{% extends "layout.html" %}

{% block title %}API Keys - Vultrino{% endblock %}
{% block nav_keys %}active{% endblock %}
{% block page_title %}API Keys{% endblock %}

{% block page_actions %}
<a href="/keys/new" class="btn btn-primary">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
    Create API Key
</a>
{% endblock %}

{% block flash_message %}
{% if let Some(f) = flash %}
<div class="flash {{ f.kind.as_class() }}">
    {{ f.message }}
</div>
{% endif %}
{% endblock %}

{% block content %}
{% if let Some(key) = new_key %}
<div class="new-key-banner">
    <div class="new-key-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        <h3>API Key Created Successfully</h3>
    </div>
    <p>Copy this key now. It will not be shown again.</p>
    <div class="key-display">
        <code id="new-api-key">{{ key }}</code>
        <button type="button" class="btn-copy" onclick="copyKey()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            Copy
        </button>
    </div>
</div>
<script>
function copyKey() {
    const key = document.getElementById('new-api-key').textContent;
    navigator.clipboard.writeText(key);
}
</script>
{% endif %}

{% if keys.is_empty() %}
<div class="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
    </svg>
    <h3>No API keys yet</h3>
    <p>Create an API key to allow applications to access Vultrino.</p>
    <a href="/keys/new" class="btn btn-primary">Create API Key</a>
</div>
{% else %}
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Key</th>
                <th>Role</th>
                <th>Expires</th>
                <th>Last Used</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for key in keys %}
            <tr>
                <td>
                    <div class="cell-primary">{{ key.name }}</div>
                    <div class="cell-secondary">Created {{ key.created_at }}</div>
                </td>
                <td><code class="key-prefix">{{ key.key_prefix }}</code></td>
                <td><span class="badge">{{ key.role_name }}</span></td>
                <td>{{ key.expires }}</td>
                <td>{{ key.last_used }}</td>
                <td class="cell-actions">
                    <form action="/keys/{{ key.id }}/revoke" method="post" class="inline-form"
                          onsubmit="return confirm('Are you sure you want to revoke this API key?')">
                        <button type="submit" class="btn-icon btn-danger" title="Revoke">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
